<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>US Lifestyle Clubs Map</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: sans-serif;
  }

  #map {
    height: 100%;
    width: 100%;
  }

  /* Style for state labels */
  .state-label {
    font-weight: bold;
    color: black;
    text-shadow: 0 0 2px white;
    pointer-events: none;
  }

  /* Adjust Leaflet controls */
  .leaflet-top.leaflet-left {
    top: 10px;  /* slightly lower */
    left: 10px;
  }
  .leaflet-control-zoom {
    margin-bottom: 5px;
  }
  .leaflet-control-resetview {
    margin-top: 5px;
  }
</style>

</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- TopoJSON plugin if needed -->
<script src="https://unpkg.com/topojson-client@3"></script>

<script>
let map = L.map('map').setView([37.8, -96], 4);

// Base map layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap contributors'
}).addTo(map);

// Controls
L.control.zoom({ position: 'topleft' }).addTo(map);

// Reset View Control
L.Control.ResetView = L.Control.extend({
  onAdd: function(map) {
    let container = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-resetview');
    container.innerHTML = '<a href="#" title="Reset View">⟳</a>';
    container.style.backgroundColor = 'white';
    container.style.width = '30px';
    container.style.height = '30px';
    container.style.textAlign = 'center';
    container.style.lineHeight = '30px';
    container.style.fontSize = '18px';
    container.style.cursor = 'pointer';

    container.onclick = function() {
      map.setView([37.8, -96], 4);
    }
    return container;
  }
});
map.addControl(new L.Control.ResetView({ position: 'topleft' }));

// Load US states GeoJSON
fetch('https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json')
  .then(res => res.json())
  .then(statesData => {

    // Load clubs.json
    fetch('clubs.json')
      .then(res => res.json())
      .then(clubsByState => {

        function getColor(stateName) {
          const colors = ['#1abc9c', '#e91e63', '#9b59b6', '#3498db', '#2ecc71', '#f1c40f'];
          const keys = Object.keys(clubsByState);
          let index = keys.indexOf(stateName) % colors.length;
          return colors[index];
        }

        function style(feature) {
          return {
            fillColor: getColor(feature.properties.name),
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
          };
        }

        function onEachFeature(feature, layer) {
          layer.on({
            mouseover: function(e) { layer.setStyle({ weight: 3 }); },
            mouseout: function(e) { geojson.resetStyle(layer); }
          });

          let stateName = feature.properties.name;
          if (clubsByState[stateName]) {
            let popupContent = `<b>${stateName}</b><br><ul>`;
            clubsByState[stateName].forEach(club => {
              popupContent += `<li><a href="${club.url}" target="_blank">${club.name}</a></li>`;
            });
            popupContent += `</ul>`;
            layer.bindPopup(popupContent);
          }

          // Add label
          let center = layer.getBounds().getCenter();
          let label = L.marker(center, {
            icon: L.divIcon({
              className: 'state-label',
              html: stateName
            }),
            interactive: false
          }).addTo(map);
        }

        let geojson = L.geoJson(statesData, {
          style: style,
          onEachFeature: onEachFeature
        }).addTo(map);

      })
      .catch(err => console.error("Error loading clubs.json:", err));

  })
  .catch(err => console.error("Error loading US states GeoJSON:", err));

</script>

</body>
</html>
