<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>US Lifestyle Clubs Map</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #map {
      width: 100%;
      height: 100%;
    }

    /* State labels */
    .state-label {
      color: black;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
      pointer-events: none;
      transition: font-size 0.3s ease, opacity 0.3s ease;
      white-space: nowrap;
      opacity: 0;
    }
    .state-label.visible {
      opacity: 1;
    }

    /* Custom buttons */
    .custom-button {
      background: white;
      border: 2px solid #666;
      border-radius: 5px;
      padding: 5px 8px;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
      margin: 5px;
      font-size: 14px;
    }
    .custom-button:hover {
      background: #f0f0f0;
    }
    .leaflet-top.leaflet-left {
      margin-top: 60px; /* Push zoom buttons slightly lower */
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-providers/leaflet-providers.js"></script>

  <script>
    // Initialize map
    const map = L.map('map', {
      center: [37.8, -96],
      zoom: 4,
      minZoom: 3,
      maxZoom: 12
    });

    // Base map
    L.tileLayer.provider('CartoDB.PositronNoLabels').addTo(map);

    // State colors
    const colors = ['#00bfae', '#ff4081', '#7c4dff', '#42a5f5', '#c6ff00', '#ffeb3b'];

    // State areas (rough relative values for scaling)
    const stateAreas = {
      Alaska: 663267, Texas: 268596, California: 163696, Montana: 147040,
      NewMexico: 121590, Arizona: 113990, Nevada: 110572, Colorado: 104094,
      Oregon: 98381, Wyoming: 97813, Michigan: 96714, Minnesota: 86936,
      Utah: 84897, Idaho: 83569, Kansas: 82278, Nebraska: 77348,
      SouthDakota: 77116, Washington: 71298, NorthDakota: 70698,
      Oklahoma: 69899, Missouri: 69707, Florida: 65758, Wisconsin: 65496,
      Georgia: 59425, Illinois: 57914, Iowa: 56272, NewYork: 54555,
      NorthCarolina: 53819, Arkansas: 53179, Alabama: 52420,
      Louisiana: 52378, Mississippi: 48432, Pennsylvania: 46058,
      Ohio: 44825, Virginia: 42775, Tennessee: 42144, Kentucky: 40408,
      Indiana: 36420, Maine: 35380, SouthCarolina: 32020, WestVirginia: 24230,
      Maryland: 12406, Vermont: 9616, NewHampshire: 9351, Massachusetts: 10565,
      NewJersey: 8723, Hawaii: 10931, Connecticut: 5543, Delaware: 2489,
      RhodeIsland: 1545, DistrictOfColumbia: 68
    };

    // Storage for state labels
    const stateLabels = {};

    // Load GeoJSON for states
    fetch('https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: feature => ({
            fillColor: colors[Math.floor(Math.random() * colors.length)],
            weight: 1,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
          }),
          onEachFeature: (feature, layer) => {
            const center = layer.getBounds().getCenter();
            const label = L.divIcon({
              className: 'state-label',
              html: feature.properties.name
            });
            const marker = L.marker(center, { icon: label }).addTo(map);
            stateLabels[feature.properties.name] = marker;
          }
        });
        updateLabelSizes();
      });

    // Function to update label sizes and visibility
    function updateLabelSizes() {
      const zoom = map.getZoom();
      
      Object.entries(stateLabels).forEach(([stateName, label]) => {
        const el = label.getElement();
        
        if (zoom < 4) {
          el.classList.remove('visible');
        } else {
          el.classList.add('visible');
          
          // Base sizes
          let baseSize;
          if (zoom === 4) baseSize = 12;
          else if (zoom === 5) baseSize = 16;
          else if (zoom === 6) baseSize = 20;
          else if (zoom === 7) baseSize = 24;
          else if (zoom <= 9) baseSize = 28;
          else baseSize = 32;
          
          // Area scaling
          const area = stateAreas[stateName] || 25000;
          const areaFactor = Math.log(area) / 18;
          
          let fontSize = baseSize + areaFactor;
          
          fontSize = Math.max(10, Math.min(40, fontSize));
          
          if (area < 10000) fontSize -= 3;
          if (area < 5000) fontSize -= 2;
          
          el.style.fontSize = `${fontSize}px`;
        }
      });
    }

    map.on('zoomend', updateLabelSizes);

    // Reset view button
    const resetBtn = L.control({ position: 'topleft' });
    resetBtn.onAdd = function() {
      const btn = L.DomUtil.create('div', 'custom-button');
      btn.innerHTML = 'Reset View';
      btn.onclick = () => map.setView([37.8, -96], 4);
      return btn;
    };
    resetBtn.addTo(map);

    // Geo locate button
    const geoBtn = L.control({ position: 'topleft' });
    geoBtn.onAdd = function() {
      const btn = L.DomUtil.create('div', 'custom-button');
      btn.innerHTML = '📍 Locate Me';
      btn.onclick = () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            pos => {
              const lat = pos.coords.latitude, lng = pos.coords.longitude;
              L.marker([lat, lng]).addTo(map).bindPopup("You are here!").openPopup();
              map.setView([lat, lng], 10);
            },
            err => alert("Error getting location: " + err.message)
          );
        } else {
          alert("Geolocation is not supported by your browser.");
        }
      };
      return btn;
    };
    geoBtn.addTo(map);
  </script>
</body>
</html>
