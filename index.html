<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>US Lifestyle Clubs Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  html, body { height: 100%; margin: 0; padding: 0; font-family: sans-serif; }
  body { display: flex; flex-direction: column; }
  #searchForm {
    flex: 0 0 auto;
    padding: 10px;
    background: #f8f8f8;
    box-shadow: 0 0 4px rgba(0,0,0,0.3);
  }
  #searchForm input { padding: 5px; margin-right: 5px; }
  #map { flex: 1 1 auto; width: 100%; }
  .leaflet-control-reset {
    background: white;
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 4px;
    box-shadow: 0 0 4px rgba(0,0,0,0.3);
    font-size: 16px;
    text-align: center;
    margin-bottom: 6px;
  }
  .club-label {
    background: rgba(255,255,255,0.8);
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: bold;
    color: #333;
    font-size: 13px;
    box-shadow: 0 0 2px rgba(0,0,0,0.4);
  }
  .state-label {
    font-weight: bold;
    font-size: 14px;
    color: #333;
    background: none;
    padding: 0;
    border-radius: 0;
    text-align: center;
    box-shadow: none;
  }
</style>
</head>
<body>

<div id="searchForm">
  <input type="text" id="zipInput" placeholder="Enter ZIP code">
  <input type="number" id="radiusInput" placeholder="Radius (miles)" min="1" value="50">
  <button id="searchBtn">Search Nearby Clubs</button>
  <button id="geoBtn">Use My Location</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const defaultCenter = [37.8, -96];
const defaultZoom = 4;

const map = L.map('map', { minZoom: 3, maxZoom: 18, zoomControl: false }).setView(defaultCenter, defaultZoom);

// Base map: Carto Voyager No Labels
L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; <a href="https://www.carto.com/">CARTO</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  subdomains: 'abcd',
  maxZoom: 19
}).addTo(map);

// Reset View Button
const ResetControl = L.Control.extend({
  options: { position: 'topleft' },
  onAdd: function(map) {
    const container = L.DomUtil.create('div', 'leaflet-control-reset');
    container.innerHTML = 'Reset View';
    L.DomEvent.on(container, 'click', e => {
      L.DomEvent.stopPropagation(e);
      map.setView(defaultCenter, defaultZoom);
    });
    return container;
  }
});
map.addControl(new ResetControl());
L.control.zoom({ position: 'topleft' }).addTo(map);

let clubsByState = {};
let geojsonLayer;

// Manual state label positions (accurately placed)
const stateLabelPositions = {
  "Alabama": [32.806671, -86.791130],
  "Alaska": [61.370716, -152.404419],
  "Arizona": [33.729759, -111.431221],
  "Arkansas": [34.969704, -92.373123],
  "California": [36.116203, -119.681564],
  "Colorado": [39.059811, -105.311104],
  "Connecticut": [41.597782, -72.755371],
  "Delaware": [39.318523, -75.507141],
  "Florida": [27.766279, -81.686783],
  "Georgia": [33.040619, -83.643074],
  "Hawaii": [21.094318, -157.498337],
  "Idaho": [44.240459, -114.478828],
  "Illinois": [40.349457, -88.986137],
  "Indiana": [39.849426, -86.258278],
  "Iowa": [42.011539, -93.210526],
  "Kansas": [38.526600, -96.726486],
  "Kentucky": [37.668140, -84.670067],
  "Louisiana": [31.169546, -91.867805],
  "Maine": [44.693947, -69.381927],
  "Maryland": [39.063946, -76.802101],
  "Massachusetts": [42.230171, -71.530106],
  "Michigan": [44.5, -85.5],
  "Minnesota": [45.694454, -93.900192],
  "Mississippi": [32.741646, -89.678696],
  "Missouri": [38.456085, -92.288368],
  "Montana": [46.921925, -110.454353],
  "Nebraska": [41.125370, -98.268082],
  "Nevada": [38.313515, -117.055374],
  "New Hampshire": [43.452492, -71.563896],
  "New Jersey": [40.298904, -74.521011],
  "New Mexico": [34.840515, -106.248482],
  "New York": [42.165726, -74.948051],
  "North Carolina": [35.630066, -79.806419],
  "North Dakota": [47.528912, -99.784012],
  "Ohio": [40.388783, -82.764915],
  "Oklahoma": [35.565342, -96.928917],
  "Oregon": [44.572021, -122.070938],
  "Pennsylvania": [40.590752, -77.209755],
  "Rhode Island": [41.680893, -71.511780],
  "South Carolina": [33.856892, -80.945007],
  "South Dakota": [44.299782, -99.438828],
  "Tennessee": [35.747845, -86.692345],
  "Texas": [31.054487, -97.563461],
  "Utah": [40.150032, -111.862434],
  "Vermont": [44.045876, -72.710686],
  "Virginia": [37.769337, -78.169968],
  "Washington": [47.400902, -121.490494],
  "West Virginia": [38.491226, -80.954456],
  "Wisconsin": [44.268543, -89.616508],
  "Wyoming": [42.755966, -107.302490],
  "DC": [38.89511, -77.03637]
};

// Load clubs.json and US states GeoJSON
Promise.all([
  fetch("clubs.json").then(r => r.json()),
  fetch("https://rawcdn.githack.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json").then(r => r.json())
]).then(([clubs, statesData]) => {
  clubsByState = clubs;
  geojsonLayer = L.geoJson(statesData, { style, onEachFeature }).addTo(map);
  addStateLabels(geojsonLayer);
}).catch(err => console.error(err));

// Style and highlight functions
function style(feature) {
  return { fillColor: "#66c2a5", weight: 2, opacity: 1, color: "white", dashArray: "3", fillOpacity: 0.7 };
}
function highlightFeature(e) {
  const layer = e.target;
  layer.setStyle({ weight: 3, color: "#666", dashArray: "", fillOpacity: 0.9 });
  layer.bringToFront();
}
function resetHighlight(e) {
  geojsonLayer.resetStyle(e.target);
}
function onEachFeature(feature, layer) {
  const stateName = feature.properties.name === 'District of Columbia' ? 'DC' : feature.properties.name;
  const clubs = clubsByState[stateName] || [];
  let popupContent = `<b>${stateName}</b><br/>`;
  if (clubs.length === 0) popupContent += "No clubs listed yet";
  else clubs.forEach(club => {
    popupContent += club.url ? `<a href="${club.url}" target="_blank">${club.name}</a><br/>` : `${club.name}<br/>`;
  });
  layer.on({ mouseover: highlightFeature, mouseout: resetHighlight, click: () => layer.bindPopup(popupContent).openPopup() });
}

// Add manually adjusted state labels
function addStateLabels(layerGroup) {
  layerGroup.eachLayer(layer => {
    const stateName = layer.feature.properties.name === 'District of Columbia' ? 'DC' : layer.feature.properties.name;
    const coords = stateLabelPositions[stateName];
    if (coords) {
      L.marker(coords, {
        icon: L.divIcon({
          className: 'state-label',
          html: stateName,
          iconSize: [0,0],
          iconAnchor: [0,0]
        })
      }).addTo(map);
    }
  });
}
</script>
</body>
</html>
